<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Axel ‚Äî –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω—É</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    /* ...–æ—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π... */
    .completed {
      color: #00c853;
      font-size: 1.2em;
      margin-left: 8px;
    }
    .exit-btn {
      background: #f06292;
      color: #fff;
      border-radius: 10px;
      padding: 8px 22px;
      font-size: 1em;
      font-weight: 700;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      margin-left: 10px;
      transition: background 0.2s;
    }
    .exit-btn:hover { background: #ad1457; }
    .congrats-card {
      background: #e1bee7;
      border-radius: 18px;
      padding: 32px 24px;
      text-align: center;
      color: #3949ab;
      font-size: 1.2em;
      margin-top: 30px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      position: relative;
      animation: fadeIn 1.2s;
    }
    .book-emoji {
      font-size: 2.5em;
      margin-bottom: 10px;
      display: block;
    }
  </style>
</head>
<body>
  <div class="triangles-bg">
    <div class="triangle t1">2¬≥</div>
    <div class="triangle t2">‚àö5</div>
    <div class="triangle t3">7</div>
    <div class="triangle t4">3¬≤</div>
    <div class="triangle t5">‚àö16</div>
    <div class="triangle t6">5‚Å¥</div>
    <div class="triangle t7">‚àö9</div>
    <div class="triangle t8">8¬≤</div>
  </div>
  <div id="app"></div>
  <script>
    // –¢–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
    const themes = [
      ["–°–ª–æ–∂–µ–Ω–∏–µ", "–í—ã—á–∏—Ç–∞–Ω–∏–µ", "–£–º–Ω–æ–∂–µ–Ω–∏–µ", "–î–µ–ª–µ–Ω–∏–µ", "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª", "–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏"],
      ["–î—Ä–æ–±–∏", "–°—Ç–µ–ø–µ–Ω–∏", "–ö–æ—Ä–Ω–∏", "–ì–µ–æ–º–µ—Ç—Ä–∏—è", "–ü—Ä–æ—Ü–µ–Ω—Ç—ã", "–ó–∞–¥–∞—á–∏ –Ω–∞ –ª–æ–≥–∏–∫—É"],
      ["–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è", "–°—Ç–µ–ø–µ–Ω–∏ –∏ –∫–æ—Ä–Ω–∏", "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è", "–§—É–Ω–∫—Ü–∏–∏", "–ì–µ–æ–º–µ—Ç—Ä–∏—è", "–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏"]
    ];

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤
    const sections = [
      {
        title: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö (1‚Äì4 –∫–ª–∞—Å—Å—ã)",
        desc: "–í–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞–Ω–∏—è: —Å–ª–æ–∂–µ–Ω–∏–µ, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ.",
        tasks: [
          // –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã —Å–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
          (lvl) => { // –°–ª–æ–∂–µ–Ω–∏–µ
            const a = Math.floor(Math.random() * (10 + lvl*2)) + 1;
            const b = Math.floor(Math.random() * (10 + lvl*2)) + 1;
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>${a} + ${b}</b>`,
              answer: a + b,
              steps: [
                `–®–∞–≥ 1: –°–∫–ª–∞–¥—ã–≤–∞–µ–º ${a} –∏ ${b}.`,
                `–®–∞–≥ 2: ${a} + ${b} = ${a + b}.`,
                `–û—Ç–≤–µ—Ç: ${a + b}.`
              ]
            };
          },
          (lvl) => { // –í—ã—á–∏—Ç–∞–Ω–∏–µ
            const a = Math.floor(Math.random() * (10 + lvl*2)) + 5;
            const b = Math.floor(Math.random() * (10 + lvl*2));
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>${a} - ${b}</b>`,
              answer: a - b,
              steps: [
                `–®–∞–≥ 1: –û—Ç–Ω–∏–º–∞–µ–º ${b} –æ—Ç ${a}.`,
                `–®–∞–≥ 2: ${a} - ${b} = ${a - b}.`,
                `–û—Ç–≤–µ—Ç: ${a - b}.`
              ]
            };
          },
          (lvl) => { // –£–º–Ω–æ–∂–µ–Ω–∏–µ
            const a = Math.floor(Math.random() * 8) + 2;
            const b = Math.floor(Math.random() * 7) + 2;
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>${a} √ó ${b}</b>`,
              answer: a * b,
              steps: [
                `–®–∞–≥ 1: –£–º–Ω–æ–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ —Å–ª–æ–∂–µ–Ω–∏–µ —á–∏—Å–ª–∞ ${a} ${b} —Ä–∞–∑.`,
                `–®–∞–≥ 2: ${a} √ó ${b} = ${Array(b).fill(a).join(' + ')} = ${a * b}.`,
                `–û—Ç–≤–µ—Ç: ${a * b}.`
              ]
            };
          },
          (lvl) => { // –î–µ–ª–µ–Ω–∏–µ
            const b = Math.floor(Math.random() * 7) + 2;
            const a = b * (Math.floor(Math.random() * 8) + 2);
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>${a} √∑ ${b}</b>`,
              answer: a / b,
              steps: [
                `–®–∞–≥ 1: –î–µ–ª–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —á–∏—Å–ª–æ ${b} –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ ${a}.`,
                `–®–∞–≥ 2: ${a} √∑ ${b} = ${a / b}.`,
                `–û—Ç–≤–µ—Ç: ${a / b}.`
              ]
            };
          },
          (lvl) => { // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
            const a = Math.floor(Math.random() * 50) + 1;
            const b = Math.floor(Math.random() * 50) + 1;
            return {
              text: `–ß—Ç–æ –±–æ–ª—å—à–µ: <b>${a}</b> –∏–ª–∏ <b>${b}</b>?`,
              answer: a > b ? `${a}` : `${b}`,
              steps: [
                `–®–∞–≥ 1: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —á–∏—Å–ª–∞ ${a} –∏ ${b}.`,
                `–®–∞–≥ 2: –ë–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ ‚Äî ${a > b ? a : b}.`,
                `–û—Ç–≤–µ—Ç: ${a > b ? a : b}.`
              ]
            };
          },
          (lvl) => { // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞
            const apples = Math.floor(Math.random() * 5) + 3;
            const friends = Math.floor(Math.random() * 3) + 2;
            return {
              text: `–£ –í–∞—Å–∏ ${apples} —è–±–ª–æ–∫, –æ–Ω –ø–æ–¥–µ–ª–∏–ª –∏—Ö –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É ${friends} –¥—Ä—É–∑—å—è–º–∏. –°–∫–æ–ª—å–∫–æ —è–±–ª–æ–∫ –ø–æ–ª—É—á–∏–ª –∫–∞–∂–¥—ã–π?`,
              answer: (apples / friends).toFixed(2),
              steps: [
                `–®–∞–≥ 1: –î–µ–ª–∏–º ${apples} —è–±–ª–æ–∫ –Ω–∞ ${friends} –¥—Ä—É–∑–µ–π.`,
                `–®–∞–≥ 2: ${apples} √∑ ${friends} = ${(apples / friends).toFixed(2)}.`,
                `–û—Ç–≤–µ—Ç: ${(apples / friends).toFixed(2)}.`
              ]
            };
          }
        ]
      },
      {
        title: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π (5‚Äì8 –∫–ª–∞—Å—Å—ã)",
        desc: "–í–∫–ª—é—á–∞–µ—Ç –¥—Ä–æ–±–∏, —Å—Ç–µ–ø–µ–Ω–∏, –∫–æ—Ä–Ω–∏, –∑–∞–¥–∞—á–∏ –Ω–∞ –≥–µ–æ–º–µ—Ç—Ä–∏—é.",
        tasks: [
          (lvl) => { // –î—Ä–æ–±–∏
            const a = Math.floor(Math.random()*9)+1;
            const b = Math.floor(Math.random()*9)+2;
            const gcd = (x, y) => y ? gcd(y, x % y) : x;
            const d = gcd(a*b, b*b);
            return {
              text: `–°–æ–∫—Ä–∞—Ç–∏—Ç–µ –¥—Ä–æ–±—å: <b>${a*b}/${b*b}</b>`,
              answer: `${a}/${b}`,
              steps: [
                `–®–∞–≥ 1: –ù–∞–π–¥—ë–º –ù–û–î —á–∏—Å–ª–∏—Ç–µ–ª—è –∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è (${a*b} –∏ ${b*b}).`,
                `–®–∞–≥ 2: –ù–û–î = ${d}.`,
                `–®–∞–≥ 3: –î–µ–ª–∏–º —á–∏—Å–ª–∏—Ç–µ–ª—å –∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –Ω–∞ –ù–û–î: ${a*b}/${b*b} = ${a}/${b}.`,
                `–û—Ç–≤–µ—Ç: ${a}/${b}.`
              ]
            };
          },
          (lvl) => { // –°—Ç–µ–ø–µ–Ω–∏
            const base = Math.floor(Math.random()*6)+2;
            const exp = Math.floor(Math.random()*2)+2;
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>${base}<sup>${exp}</sup></b>`,
              answer: Math.pow(base,exp),
              steps: [
                `–®–∞–≥ 1: –û—Å–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–ø–µ–Ω–∏ ‚Äî ${base}, –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å ‚Äî ${exp}.`,
                `–®–∞–≥ 2: ${base}<sup>${exp}</sup> = ${Array(exp).fill(base).join(' √ó ')} = ${Math.pow(base,exp)}.`,
                `–û—Ç–≤–µ—Ç: ${Math.pow(base,exp)}.`
              ]
            };
          },
          (lvl) => { // –ö–æ—Ä–Ω–∏
            const num = Math.pow(Math.floor(Math.random()*8)+2,2);
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>‚àö${num}</b>`,
              answer: Math.sqrt(num),
              steps: [
                `–®–∞–≥ 1: –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ç–∞–∫–æ–µ —á–∏—Å–ª–æ, –∫–≤–∞–¥—Ä–∞—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–≤–µ–Ω ${num}.`,
                `–®–∞–≥ 2: ‚àö${num} = ${Math.sqrt(num)}.`,
                `–û—Ç–≤–µ—Ç: ${Math.sqrt(num)}.`
              ]
            };
          },
          (lvl) => { // –ì–µ–æ–º–µ—Ç—Ä–∏—è
            const side = Math.floor(Math.random()*10)+3;
            return {
              text: `–ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–∏–º–µ—Ç—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω–æ–π <b>${side}</b>`,
              answer: side*4,
              steps: [
                `–®–∞–≥ 1: –§–æ—Ä–º—É–ª–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞: 4 √ó —Å—Ç–æ—Ä–æ–Ω–∞.`,
                `–®–∞–≥ 2: 4 √ó ${side} = ${side*4}.`,
                `–û—Ç–≤–µ—Ç: ${side*4}.`
              ]
            };
          },
          (lvl) => { // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
            const total = Math.floor(Math.random()*200)+100;
            const percent = Math.floor(Math.random()*50)+10;
            return {
              text: `–ù–∞–π–¥–∏—Ç–µ ${percent}% –æ—Ç ${total}`,
              answer: ((total*percent)/100).toFixed(2),
              steps: [
                `–®–∞–≥ 1: ${percent}% ‚Äî —ç—Ç–æ ${percent}/100.`,
                `–®–∞–≥ 2: ${total} √ó ${percent}/100 = ${(total*percent/100).toFixed(2)}.`,
                `–û—Ç–≤–µ—Ç: ${(total*percent/100).toFixed(2)}.`
              ]
            };
          },
          (lvl) => { // –õ–æ–≥–∏–∫–∞
            return {
              text: `–í –∫–æ—Ä–æ–±–∫–µ 3 –∫—Ä–∞—Å–Ω—ã—Ö –∏ 2 —Å–∏–Ω–∏—Ö —à–∞—Ä–∏–∫–∞. –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —à–∞—Ä–∏–∫–æ–≤?`,
              answer: 5,
              steps: [
                `–®–∞–≥ 1: –°–∫–ª–∞–¥—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Å–Ω—ã—Ö –∏ —Å–∏–Ω–∏—Ö —à–∞—Ä–∏–∫–æ–≤.`,
                `–®–∞–≥ 2: 3 + 2 = 5.`,
                `–û—Ç–≤–µ—Ç: 5.`
              ]
            };
          }
        ]
      },
      {
        title: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö (9‚Äì11 –∫–ª–∞—Å—Å—ã)",
        desc: "–°–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ —Ç–µ–º–∞—Ç–∏–∫–∞–º —Å—Ç–∞—Ä—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –†–æ—Å—Å–∏–∏.",
        tasks: [
          (lvl) => { // –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
            const a = Math.floor(Math.random()*3)+1;
            const b = Math.floor(Math.random()*10)-5;
            const c = Math.floor(Math.random()*10)-5;
            const D = b*b-4*a*c;
            let answer;
            if(D<0) answer="–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ—Ä–Ω–µ–π";
            else if(D===0) answer=(-b/(2*a)).toFixed(2);
            else answer=`${((-b+Math.sqrt(D))/(2*a)).toFixed(2)}, ${((-b-Math.sqrt(D))/(2*a)).toFixed(2)}`;
            return {
              text: `–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: <b>${a}x¬≤${b>=0?'+':''}${b}x${c>=0?'+':''}${c}=0</b>`,
              answer,
              steps: [
                `–®–∞–≥ 1: –ù–∞–π–¥—ë–º –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç: D = b¬≤ - 4ac.`,
                `–®–∞–≥ 2: D = ${b}¬≤ - 4√ó${a}√ó${c} = ${D}.`,
                D<0
                  ? `–®–∞–≥ 3: D < 0, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ—Ä–Ω–µ–π –Ω–µ—Ç.`
                  : D===0
                    ? `–®–∞–≥ 3: D = 0, –æ–¥–∏–Ω –∫–æ—Ä–µ–Ω—å: x = -b/(2a) = ${(-b/(2*a)).toFixed(2)}.`
                    : `–®–∞–≥ 3: D > 0, –¥–≤–∞ –∫–æ—Ä–Ω—è: x‚ÇÅ = ${((-b+Math.sqrt(D))/(2*a)).toFixed(2)}, x‚ÇÇ = ${((-b-Math.sqrt(D))/(2*a)).toFixed(2)}.`,
                `–û—Ç–≤–µ—Ç: ${answer}.`
              ]
            };
          },
          (lvl) => { // –°—Ç–µ–ø–µ–Ω–∏ –∏ –∫–æ—Ä–Ω–∏
            const base = Math.floor(Math.random()*10)+2;
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>‚àö${base*base}</b>`,
              answer: base,
              steps: [
                `–®–∞–≥ 1: ‚àö${base*base} ‚Äî —ç—Ç–æ —á–∏—Å–ª–æ, –∫–≤–∞–¥—Ä–∞—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–≤–µ–Ω ${base*base}.`,
                `–®–∞–≥ 2: ‚àö${base*base} = ${base}.`,
                `–û—Ç–≤–µ—Ç: ${base}.`
              ]
            };
          },
          (lvl) => { // –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>sin(90¬∞)</b>`,
              answer: 1,
              steps: [
                `–®–∞–≥ 1: –ó–Ω–∞—á–µ–Ω–∏–µ —Å–∏–Ω—É—Å–∞ 90¬∞ ‚Äî —ç—Ç–æ 1.`,
                `–û—Ç–≤–µ—Ç: 1.`
              ]
            };
          },
          (lvl) => { // –§—É–Ω–∫—Ü–∏–∏
            const x = Math.floor(Math.random()*10)+1;
            return {
              text: `–í—ã—á–∏—Å–ª–∏—Ç–µ: <b>f(x) = 2x + 3</b> –ø—Ä–∏ x = ${x}`,
              answer: 2*x+3,
              steps: [
                `–®–∞–≥ 1: –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º x = ${x} –≤ —Ñ–æ—Ä–º—É–ª—É.`,
                `–®–∞–≥ 2: 2√ó${x} + 3 = ${2*x+3}.`,
                `–û—Ç–≤–µ—Ç: ${2*x+3}.`
              ]
            };
          },
          (lvl) => { // –ì–µ–æ–º–µ—Ç—Ä–∏—è
            const r = Math.floor(Math.random()*8)+2;
            return {
              text: `–ù–∞–π–¥–∏—Ç–µ –¥–ª–∏–Ω—É –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ —Ä–∞–¥–∏—É—Å–∞ <b>${r}</b> (œÄ ‚âà 3.14)`,
              answer: (2*3.14*r).toFixed(2),
              steps: [
                `–®–∞–≥ 1: –§–æ—Ä–º—É–ª–∞ –¥–ª–∏–Ω—ã –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏: 2œÄr.`,
                `–®–∞–≥ 2: 2√ó3.14√ó${r} = ${(2*3.14*r).toFixed(2)}.`,
                `–û—Ç–≤–µ—Ç: ${(2*3.14*r).toFixed(2)}.`
              ]
            };
          },
          (lvl) => { // –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏
            return {
              text: `–í –∫–ª–∞—Å—Å–µ 12 –º–∞–ª—å—á–∏–∫–æ–≤ –∏ 15 –¥–µ–≤–æ—á–µ–∫. –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤?`,
              answer: 27,
              steps: [
                `–®–∞–≥ 1: –°–∫–ª–∞–¥—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞–ª—å—á–∏–∫–æ–≤ –∏ –¥–µ–≤–æ—á–µ–∫.`,
                `–®–∞–≥ 2: 12 + 15 = 27.`,
                `–û—Ç–≤–µ—Ç: 27.`
              ]
            };
          }
        ]
      }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç–µ–º
    let completedThemes = [[], [], []];

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
    const app = document.getElementById('app');
    let state = { step: "welcome" };

    function render() {
      if(state.step==="welcome") {
        app.innerHTML = `
          <div class="main-card">
            <div class="main-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ Axel!</div>
            <div class="main-desc">–≠—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —ç–∫–∑–∞–º–µ–Ω—É –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ. –í–∞—Å –∂–¥—É—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–±—É—á–µ–Ω–∏—è –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏!</div>
            <button class="btn btn-enter" id="btnEnter">–í–æ–π—Ç–∏</button>
          </div>
        `;
        document.getElementById('btnEnter').onclick = () => {
          state.step = "sections";
          render();
        };
      } else if(state.step==="sections") {
        app.innerHTML = `
          <div class="main-card">
            <div class="main-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</div>
            <div class="section-list">
              ${sections.map((s,i)=>`
                <div class="section-card">
                  <div class="section-title">${s.title}</div>
                  <div class="section-desc">${s.desc}</div>
                  <button class="btn-section" data-idx="${i}">–í–æ–π—Ç–∏ –≤ –≤–∞—Ä–∏–∞–Ω—Ç</button>
                </div>
              `).join('')}
            </div>
            <button class="exit-btn" id="exitApp">–í—ã–π—Ç–∏</button>
          </div>
        `;
        document.querySelectorAll('.btn-section').forEach(btn=>{
          btn.onclick = () => {
            state.section = +btn.dataset.idx;
            state.step = "themes";
            render();
          };
        });
        document.getElementById('exitApp').onclick = () => {
          state.step = "welcome";
          render();
        };
      } else if(state.step==="themes") {
        app.innerHTML = `
          <div class="main-card">
            <div class="main-title">${sections[state.section].title}</div>
            <div class="section-desc">${sections[state.section].desc}</div>
            <div class="options-list">
              ${themes[state.section].map((theme, i) => `
                <div class="option-card" data-idx="${i}">
                  ${theme}
                  ${completedThemes[state.section][i] ? '<span class="completed">‚úî</span>' : ''}
                </div>
              `).join('')}
            </div>
            <button class="exit-btn" id="exitSection">–í—ã–π—Ç–∏ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞</button>
          </div>
        `;
        document.querySelectorAll('.option-card').forEach(btn=>{
          btn.onclick = () => {
            state.theme = +btn.dataset.idx;
            state.taskIdx = 0;
            state.step = "task";
            render();
          };
        });
        document.getElementById('exitSection').onclick = () => {
          state.step = "sections";
          render();
        };
      } else if(state.step==="task") {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏–µ
        const lvl = state.taskIdx;
        const taskGen = sections[state.section].tasks[state.theme];
        const task = taskGen(lvl);
        app.innerHTML = `
          <div class="main-card">
            <div class="main-title">–¢–µ–º–∞: ${themes[state.section][state.theme]}</div>
            <div class="task-card">
              <div class="task-title">${task.text}</div>
              <input class="task-input" id="taskInput" autocomplete="off" />
              <button class="btn-check" id="btnCheck">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
              <div id="taskResult"></div>
            </div>
            <button class="exit-btn" id="exitTheme">–í—ã–π—Ç–∏ –∏–∑ —Ç–µ–º—ã</button>
          </div>
        `;
        document.getElementById('exitTheme').onclick = () => {
          state.step = "themes";
          render();
        };
        document.getElementById('btnCheck').onclick = () => {
          const val = document.getElementById('taskInput').value.trim();
          let correct = false;
          if(typeof task.answer === "number") correct = Number(val) === task.answer;
          else correct = val === String(task.answer);
          const result = document.getElementById('taskResult');
          if(correct) {
            result.innerHTML = `<button class="btn-next" id="btnNext">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`;
            document.getElementById('btnNext').onclick = () => {
              if(state.taskIdx<9) {
                state.taskIdx++;
                render();
              } else {
                completedThemes[state.section][state.theme] = true;
                state.step = "congrats";
                render();
              }
            };
          } else {
            // –≠—Ç–∞–ø–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
            let stepIdx = 0;
            function showStep() {
              result.innerHTML = `<div class="explanation">${task.steps[stepIdx]}</div>` +
                (stepIdx < task.steps.length - 1
                  ? `<button class="btn-next" id="btnStepNext">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥</button>`
                  : "");
              if (stepIdx < task.steps.length - 1) {
                document.getElementById('btnStepNext').onclick = () => {
                  stepIdx++;
                  showStep();
                };
              }
            }
            showStep();
          }
        };
      } else if(state.step==="congrats") {
        app.innerHTML = `
          <div class="main-card congrats-card">
            <span class="book-emoji">üìö</span>
            <div>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ç–µ–º—É <b>${themes[state.section][state.theme]}</b>!</div>
            <div>–í—ã ‚Äî –º–æ–ª–æ–¥–µ—Ü! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —É—á–∏—Ç—å—Å—è –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –Ω–æ–≤—ã—Ö —É—Å–ø–µ—Ö–æ–≤!</div>
            <button class="btn-next" id="btnToThemes">–ö —Ç–µ–º–∞–º</button>
          </div>
        `;
        document.getElementById('btnToThemes').onclick = () => {
          state.step = "themes";
          render();
        };
      }
    }
    render();
  </script>
</body>
</html>
